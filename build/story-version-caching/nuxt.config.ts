import mkcert from "vite-plugin-mkcert";

export default defineNuxtConfig({
  compatibilityDate: "2026-01-13",
  devtools: { enabled: false },
  modules: ["@storyblok/nuxt"],

  storyblok: {
    accessToken: process.env.STORYBLOK_DELIVERY_API_TOKEN,
    apiOptions: {
      /** Set the correct region for your space. Learn more: https://www.storyblok.com/docs/packages/storyblok-js#example-region-parameter */
      region: process.env.STORYBLOK_REGION || "eu",
      /** The following code is only required when creating a Storyblok space directly via the Blueprints feature. */
      endpoint: process.env.STORYBLOK_API_BASE_URL
        ? `${new URL(process.env.STORYBLOK_API_BASE_URL).origin}/v2`
        : undefined,
    },
  },

  app: {
    head: {
      link: [
        {
          rel: "stylesheet",
          href: "https://a.storyblok.com/f/212319/x/e6ccda03b8/blueprint-blank.css",
        },
      ],
    },
  },

    runtimeConfig: {
      supabaseUrl: process.env.SUPABASE_URL,
      supabaseKey: process.env.SUPABASE_PUBLISHABLE_KEY,
      storyblokWebhookToken: process.env.STORYBLOK_WEBHOOK_TOKEN,

    public: {
      storyblokToken: process.env.STORYBLOK_DELIVERY_API_TOKEN,
      supabaseCacheTable: process.env.NEXT_PUBLIC_SUPABASE_CACHE_TABLE || 'edge_cache',
    },
  },

  ssr: true,

  devServer: {
    https: true,
  },

  vite: {
    plugins: [mkcert()],
  },
});
